(self.webpackChunkbugu=self.webpackChunkbugu||[]).push([[1955],{1245:(n,e,s)=>{"use strict";s.r(e),s.d(e,{data:()=>a});const a={key:"v-535a2c0e",path:"/old_blog/iOS%E8%AF%BB%E5%8F%96%E7%BD%91%E7%BB%9C%E6%97%B6%E9%97%B4%E7%9A%84%E5%87%A0%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%88OC%EF%BC%89.html",title:"一",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[],filePathRelative:"old_blog/iOS读取网络时间的几个方法（OC）.md",git:{updatedTime:1597237797e3}}},103:(n,e,s)=>{"use strict";s.r(e),s.d(e,{default:()=>t});const a=(0,s(6252).uE)('<p>实现iOS读取网络时间的方法，实现时收集到几个写法。可以使用，记录一下。</p><h1 id="一"><a class="header-anchor" href="#一">#</a> 一</h1><div class="language-Objectve ext-Objectve line-numbers-mode"><pre class="language-Objectve"><code>- (NSDate *)getInternetDate\n{\n    NSString *urlString = @&quot;https://m.baidu.com&quot;;\n    urlString = [urlString stringByAddingPercentEscapesUsingEncoding: NSUTF8StringEncoding];\n    NSMutableURLRequest *request = [[NSMutableURLRequest alloc] init];\n    [request setURL:[NSURL URLWithString: urlString]];\n    [request setCachePolicy:NSURLRequestReloadIgnoringCacheData];\n    [request setTimeoutInterval: 2];\n    [request setHTTPShouldHandleCookies:FALSE];\n    [request setHTTPMethod:@&quot;GET&quot;];\n    NSHTTPURLResponse *response;\n    [NSURLConnection sendSynchronousRequest:request returningResponse:&amp;response error:nil];\n    \n    NSString *date = [[response allHeaderFields] objectForKey:@&quot;Date&quot;];\n    date = [date substringFromIndex:5];\n    date = [date substringToIndex:[date length]-4];\n    NSDateFormatter *dMatter = [[NSDateFormatter alloc] init];\n    dMatter.locale = [[NSLocale alloc] initWithLocaleIdentifier:@&quot;en_US&quot;];\n    [dMatter setDateFormat:@&quot;dd MMM yyyy HH:mm:ss&quot;];\n    NSDate *netDate = [[dMatter dateFromString:date] dateByAddingTimeInterval:60*60*8];\n    NSTimeZone *zone = [NSTimeZone systemTimeZone];\n    NSInteger interval = [zone secondsFromGMTForDate: netDate];\n    NSDate *localeDate = [netDate  dateByAddingTimeInterval: interval];\n    return localeDate;\n}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h1 id="二"><a class="header-anchor" href="#二">#</a> 二</h1><div class="language-Objectve ext-Objectve line-numbers-mode"><pre class="language-Objectve"><code>- (NSString *)getInternetDateString\n{\n    //NSString *urlString = @&quot;https://www.baidu.com&quot;;\n    NSString *urlString = @&quot;http://www.beijing-time.org/time.asp&quot;;\n    urlString = [urlString stringByAddingPercentEscapesUsingEncoding: NSUTF8StringEncoding];\n    NSMutableURLRequest *request = [[NSMutableURLRequest alloc] init];\n    [request setURL:[NSURL URLWithString: urlString]];\n    [request setCachePolicy:NSURLRequestReloadIgnoringCacheData];\n    [request setTimeoutInterval: 2];\n    [request setHTTPShouldHandleCookies:FALSE];\n    [request setHTTPMethod:@&quot;GET&quot;];\n    NSHTTPURLResponse *response;\n    [NSURLConnection sendSynchronousRequest:request returningResponse:&amp;response error:nil];\n    //NSLog(@&quot;&gt;&gt;&gt;&gt;&gt; response :%@&quot;,response);\n    NSString *date = [[response allHeaderFields] objectForKey:@&quot;Date&quot;];\n    \n    //NSLog(@&quot;&gt;&gt;&gt;&gt;&gt; date :%@&quot;,date);\n    date = [date substringFromIndex:5];\n    date = [date substringToIndex:[date length]-4];\n    //NSLog(@&quot;&gt;&gt;&gt;&gt;&gt; date :%@&quot;,date);\n    NSDateFormatter *dMatter = [[NSDateFormatter alloc] init];\n    dMatter.locale = [[NSLocale alloc] initWithLocaleIdentifier:@&quot;en_US&quot;];\n    //    dMatter.locale = [[NSLocale alloc] initWithLocaleIdentifier:@&quot;zh-CHS&quot;];\n    [dMatter setDateFormat:@&quot;dd MMM yyyy HH:mm:ss&quot;];\n    NSDate *netDate = [[dMatter dateFromString:date] dateByAddingTimeInterval:60*60*8];\n    NSTimeZone *zone = [NSTimeZone systemTimeZone];\n    NSInteger interval = [zone secondsFromGMTForDate: netDate];\n    NSDate *localeDate = [netDate  dateByAddingTimeInterval: interval];\n    //NSLog(@&quot;&gt;&gt;&gt;&gt;&gt; localeDate :%@&quot;,localeDate);\n    NSString *tmpDate = [NSString stringWithFormat:@&quot;%@&quot;,localeDate];\n    tmpDate = [tmpDate stringByReplacingOccurrencesOfString:@&quot; +0000&quot; withString:@&quot;&quot;];\n    //NSLog(@&quot;&gt;&gt;&gt;&gt;&gt; localeDate :%@&quot;,tmpDate);\n    \n    NSDateFormatter *format1=[[NSDateFormatter alloc]init];\n    [format1 setDateFormat:@&quot;yyyy/MM/dd HH:mm:ss&quot;];\n    NSDate *nowDate = [format1 dateFromString:tmpDate];\n    NSString *nowDate_ = [format1 stringFromDate:nowDate];\n    return nowDate_;\n}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h1 id="三"><a class="header-anchor" href="#三">#</a> 三</h1><div class="language-Objectve ext-Objectve line-numbers-mode"><pre class="language-Objectve"><code>- (void)getInternetDateWithSuccess:(void(^)(NSDate * date))success\n                           failure:(void(^)(NSError *error))failure{\n    \n    //1.创建URL\n    NSString *urlString = @&quot;https://m.baidu.com&quot;;\n    urlString = [urlString stringByAddingPercentEncodingWithAllowedCharacters:[NSCharacterSet URLQueryAllowedCharacterSet]];\n    \n    //2.创建request请求对象\n    NSMutableURLRequest *request = [[NSMutableURLRequest alloc] init];\n    [request setURL:[NSURL URLWithString: urlString]];\n    [request setCachePolicy:NSURLRequestReloadIgnoringCacheData];\n    [request setTimeoutInterval:5];\n    [request setHTTPShouldHandleCookies:FALSE];\n    [request setHTTPMethod:@&quot;GET&quot;];\n    \n    //3.创建URLSession对象\n    NSURLSession *session = [NSURLSession sharedSession];\n    \n    //4.设置数据返回回调的block\n    NSURLSessionDataTask *task = [session dataTaskWithRequest:request completionHandler:^(NSData *data, NSURLResponse *response, NSError *error) {\n        if (error == nil &amp;&amp; response != nil) {\n            //这么做的原因是简体中文下的手机不能识别“MMM”，只能识别“MM”\n            NSArray *monthEnglishArray = @[@&quot;Jan&quot;,@&quot;Feb&quot;,@&quot;Mar&quot;,@&quot;Apr&quot;,@&quot;May&quot;,@&quot;Jun&quot;,@&quot;Jul&quot;,@&quot;Aug&quot;,@&quot;Sept&quot;,@&quot;Sep&quot;,@&quot;Oct&quot;,@&quot;Nov&quot;,@&quot;Dec&quot;];\n            NSArray *monthNumArray = @[@&quot;01&quot;,@&quot;02&quot;,@&quot;03&quot;,@&quot;04&quot;,@&quot;05&quot;,@&quot;06&quot;,@&quot;07&quot;,@&quot;08&quot;,@&quot;09&quot;,@&quot;09&quot;,@&quot;10&quot;,@&quot;11&quot;,@&quot;12&quot;];\n            NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;\n            NSDictionary *allHeaderFields = [httpResponse allHeaderFields];\n            NSString *dateStr = [allHeaderFields objectForKey:@&quot;Date&quot;];\n            dateStr = [dateStr substringFromIndex:5];\n            dateStr = [dateStr substringToIndex:[dateStr length]-4];\n            dateStr = [dateStr stringByAppendingString:@&quot; +0000&quot;];\n            //当前语言是中文的话，识别不了英文缩写\n            for (NSInteger i = 0 ; i &lt; monthEnglishArray.count ; i++) {\n                NSString *monthEngStr = monthEnglishArray[i];\n                NSString *monthNumStr = monthNumArray[i];\n                dateStr = [dateStr stringByReplacingOccurrencesOfString:monthEngStr withString:monthNumStr];\n            }\n            NSDateFormatter *dMatter = [[NSDateFormatter alloc] init];\n            [dMatter setDateFormat:@&quot;dd MM yyyy HH:mm:ss Z&quot;];\n            NSDate *netDate = [dMatter dateFromString:dateStr];\n            NSTimeInterval timeInterval = [netDate timeIntervalSince1970];\n            dispatch_async(dispatch_get_main_queue(), ^{\n                success(netDate);\n            });\n        }else{\n            dispatch_async(dispatch_get_main_queue(), ^{\n                failure(error);\n            });\n        }\n    }];\n    //5、执行网络请求\n    [task resume];\n    \n}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div>',7),t={render:function(n,e){return a}}}}]);